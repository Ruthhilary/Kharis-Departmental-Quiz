<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kharis Department Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
  * {
    box-sizing: border-box; margin: 0; padding: 0;
  }
  body {
    font-family: 'Quicksand', sans-serif;
    background: url('https://kharis.org/wp-content/uploads/2022/11/271239127_4868436629869265_1030465267411614205_n.jpg') center/cover no-repeat fixed;
    color: #fff;
    overflow-x: hidden;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem;
  }
  .container {
    max-width: 700px;
    width: 100%;
    background: rgba(60,19,97,0.85);
    border-radius: 20px;
    padding: 2rem 3rem;
    text-align: center;
    box-shadow: 0 0 20px #8e24aaaa;
    animation: fadeIn 1s ease forwards;
    position: relative;
    display: flex;
    flex-direction: column;
  }
  h1, h2, h3 {
    font-family: 'Fredoka One', cursive;
    margin-bottom: 1.5rem;
  }
  .btn {
    background: #fff;
    color: #6a1b9a;
    border: none;
    padding: 1rem 2rem;
    margin: 1rem 0.5rem;
    border-radius: 50px;
    font-size: 1.2rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    transition: background 0.3s, color 0.3s;
    min-width: 140px;
    user-select: none;
  }
  .btn:hover, .btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .question {
    font-size: 1.9rem;
    margin-bottom: 2rem;
  }
  .answers {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .result h2 {
    margin-bottom: 2rem;
    font-size: 2.5rem;
  }
  .result .department {
    font-size: 1.8rem;
    margin: 1rem 0 0.5rem;
    font-weight: bold;
  }
  .result .description {
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
  }
  .result .home-btn, .result .another-btn {
    margin-top: 1rem;
    background: #ffd700;
    color: #3c1361;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    min-width: 160px;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  .result .home-btn:hover, .result .home-btn:focus, 
  .result .another-btn:hover, .result .another-btn:focus {
    background: #6a1b9a;
    color: #ffd700;
    outline: none;
  }
  .back-btn {
    background: transparent;
    color: #ffd700;
    border: 2px solid #ffd700;
    padding: 0.6rem 1.4rem;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    user-select: none;
    transition: background 0.3s, color 0.3s;
    align-self: center;
    margin-top: 1rem;
    width: max-content;
  }
  .back-btn:hover, .back-btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .confetti {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }
  /* Responsive styles for tablets and iPads */
  @media (max-width: 1024px) {
    .container { padding: 1.5rem 2rem; }
    .question { font-size: 1.6rem; }
    .btn { font-size: 1rem; padding: 0.8rem 1.5rem; }
    .result h2 { font-size: 2rem; }
    .result .department { font-size: 1.5rem; }
    .result .description { font-size: 1rem; }
    .result .home-btn, .result .another-btn, .back-btn { font-size: 0.9rem; padding: 0.6rem 1.2rem; }
  }
  /* Responsive styles for smaller tablets and iPads in portrait */
  @media (max-width: 768px) {
    .container { padding: 1.2rem 1.5rem; }
    .question { font-size: 1.4rem; }
    .btn { font-size: 0.95rem; padding: 0.7rem 1.2rem; }
    .result h2 { font-size: 1.8rem; }
    .result .department { font-size: 1.3rem; }
    .result .description { font-size: 0.95rem; }
  }
</style>
</head>
<body>
<div class="container" role="main" aria-live="polite" aria-atomic="true">
  <div class="start-screen" id="start-screen">
    <h1>Are You Ready to Discover Your Place?</h1>
    <button class="btn" id="start-london">Kharis Church London</button>
    <button class="btn" id="start-kp2">KP2</button>
  </div>
  <div class="question-section" id="quiz" style="display:none;"></div>
  <button class="back-btn" id="back-btn" style="display:none;" aria-label="Go back to previous question">&larr; Back</button>
  <div class="result" id="result" style="display:none;"></div>
  <canvas id="confetti-canvas" class="confetti"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const quizEl = document.getElementById('quiz');
const startScreenEl = document.getElementById('start-screen');
const resultEl = document.getElementById('result');
const backBtn = document.getElementById('back-btn');
const confettiCanvas = document.getElementById('confetti-canvas');
const confettiInstance = confettiCanvas && confettiCanvas.getContext ? window.confetti : null;

const questions = {
  london: [
    {
      question: "When faced with chaos, what grounds you most?",
      answers: [
        { text: "A plan", dept: "Administration" },
        { text: "A calm presence", dept: "Host Team" },
        { text: "A Purpose", dept: "Evangelism/New Believers" },
        { text: "To offer warmth to everyone", dept: "Hospitality" },
        { text: "A reset moment", dept: "Sanctuary Keepers" },
      ],
    },
    {
      question: "In conversations, what do you often find yourself doing most?",
      answers: [
        { text: "Working behind the scenes to produce excellent events", dept: "Production" },
        { text: "Leading or playing music that touches hearts", dept: "Music" },
        { text: "Reaching out and following up with new people", dept: "Follow Up" },
        { text: "Helping new believers grow in faith", dept: "New Believers" },
        { text: "Sharing the good news through evangelism", dept: "Evangelism" },
      ],
    },
    {
      question: "How do you nurture your faith during your personal time?",
      answers: [
        { text: "Protecting and caring for the sanctuary and holy places", dept: "Sanctuary Keepers" },
        { text: "Organising and keeping things orderly", dept: "Administration" },
        { text: "Supporting the welfare of others", dept: "Welfare" },
        { text: "Creating engaging content for social media", dept: "Social Media" },
        { text: "Helping in children's ministry", dept: "Children's Department" },
      ],
    },
  ],
  kp2: [
    {
      question: "Which environment energizes you the most?",
      answers: [
        { text: "Organising and administration", dept: "Administration" },
        { text: "Creating eye-catching designs", dept: "Design" },
        { text: "Performing in drama", dept: "K-Drama" },
        { text: "Welcoming guests warmly", dept: "Hospitality" },
        { text: "Security and protection", dept: "Security" },
      ],
    },
    {
      question: "What's your role when serving in a team?",
      answers: [
        { text: "Leading worship or playing music", dept: "K-Music" },
        { text: "Managing social media and media content", dept: "Media/Social Media" },
        { text: "Supporting setup and teardown", dept: "Set-up" },
        { text: "Helping new believers and evangelism", dept: "New Believers/Evangelism" },
        { text: "Assisting with hospitality and guest hosting", dept: "Hospitality/Host Team" },
      ],
    },
    {
      question: "Which activity do you find most fulfilling?",
      answers: [
        { text: "Providing welfare and care", dept: "Welfare" },
        { text: "Helping with ushering and welcoming", dept: "Ushers" },
        { text: "Ensuring sound and production quality", dept: "Sound" },
        { text: "Participating in follow up ministry", dept: "Follow Up" },
        { text: "Working behind the scenes in administration", dept: "Administration" },
      ],
    },
  ]
};

const departmentDescriptions = {
  "Administration": "Organize and manage church operations and events.",
  "Children's Department": "Teach and nurture children in their faith.",
  "Design": "Create visuals and designs for church materials and media.",
  "Drama": "Act and produce plays to share messages creatively.",
  "Hospitality": "Welcome and care for guests and congregation members.",
  "Host Team": "Facilitate a warm and welcoming church environment.",
  "Production": "Manage sound, lighting, and technical equipment.",
  "Music": "Lead worship and play musical instruments during services.",
  "Follow Up": "Connect with newcomers and support spiritual growth.",
  "New Believers": "Help new Christians grow in their faith.",
  "Evangelism": "Share the Gospel and reach out to the community.",
  "Sanctuary Keepers": "Maintain and care for the worship spaces.",
  "Set-up": "Prepare rooms and equipment for events and services.",
  "Social Media": "Manage the churchâ€™s online presence and communications.",
  "Sound": "Ensure quality audio during church events.",
  "Uniform": "Manage and coordinate uniforms for teams.",
  "Ushers": "Assist in seating and helping attendees during services.",
  "Welfare": "Provide support and care to those in need.",
  "Security": "Maintain safety and security during events.",
  "K-Drama": "Perform and direct drama in KP2.",
  "Media": "Manage video and media production in KP2.",
  "K-Music": "Lead and perform music ministry in KP2."
};

let currentSet = null; // 'london' or 'kp2'
let currentQuestionIndex = 0;
let answers = [];
let scores = {};

const startLondonBtn = document.getElementById('start-london');
const startKP2Btn = document.getElementById('start-kp2');

startLondonBtn.addEventListener('click', () => startQuiz('london'));
startKP2Btn.addEventListener('click', () => startQuiz('kp2'));

backBtn.addEventListener('click', () => {
  if(currentQuestionIndex > 0){
    currentQuestionIndex--;
    answers.pop();
    recalculateScores();
    renderQuestion();
  }
  if(currentQuestionIndex === 0){
    backBtn.style.display = 'none';
  }
});

function startQuiz(set) {
  currentSet = set;
  currentQuestionIndex = 0;
  answers = [];
  scores = {};
  startScreenEl.style.display = 'none';
  resultEl.style.display = 'none';
  backBtn.style.display = 'none';
  quizEl.style.display = 'block';
  renderQuestion();
}

function renderQuestion() {
  backBtn.style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
  const questionObj = questions[currentSet][currentQuestionIndex];
  if (!questionObj) {
    showResult();
    return;
  }

  quizEl.innerHTML = `
    <div class="question" id="question-text">${questionObj.question}</div>
    <div class="answers" role="list" aria-label="Possible answers">
      ${questionObj.answers.map((ans, i) => `
        <button class="btn answer-btn" data-index="${i}" role="listitem" aria-pressed="false">${ans.text}</button>
      `).join('')}
    </div>
  `;

  const answerButtons = quizEl.querySelectorAll('.answer-btn');
  answerButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      const index = parseInt(e.target.getAttribute('data-index'), 10);
      handleAnswer(index);
    });
  });

  // If user previously answered this question, highlight it
  if (answers[currentQuestionIndex] !== undefined) {
    const prevIndex = answers[currentQuestionIndex];
    if (answerButtons[prevIndex]) {
      answerButtons[prevIndex].setAttribute('aria-pressed', 'true');
    }
  }
}

function handleAnswer(answerIndex) {
  // Save answer for current question
  answers[currentQuestionIndex] = answerIndex;

  // Calculate scores
  recalculateScores();

  currentQuestionIndex++;

  if(currentQuestionIndex < questions[currentSet].length){
    renderQuestion();
  } else {
    showResult();
  }

  backBtn.style.display = 'inline-block';
}

function recalculateScores() {
  scores = {};
  for(let i = 0; i < answers.length; i++){
    const answerIdx = answers[i];
    if(answerIdx === undefined) continue;
    const dept = questions[currentSet][i].answers[answerIdx].dept;
    if(!scores[dept]) scores[dept] = 0;
    scores[dept]++;
  }
}

function showResult() {
  quizEl.style.display = 'none';
  backBtn.style.display = 'none';
  resultEl.style.display = 'block';

  // Find department with highest score
  let highestScore = 0;
  let winningDepartments = [];
  for(const dept in scores){
    if(scores[dept] > highestScore){
      highestScore = scores[dept];
      winningDepartments = [dept];
    } else if(scores[dept] === highestScore){
      winningDepartments.push(dept);
    }
  }

  // In case of tie, pick first alphabetically
  winningDepartments.sort();
  const topDept = winningDepartments[0] || "Administration";

  // Department description
  const description = departmentDescriptions[topDept] || "A valuable ministry in our church.";

  // Show result
  resultEl.innerHTML = `
    <h2>Your Recommended Department is:</h2>
    <div class="department">${topDept}</div>
    <div class="description">${description}</div>
    <button class="another-btn btn" id="restart-btn">Take the Quiz Again</button>
  `;

  document.getElementById('restart-btn').addEventListener('click', () => {
    resultEl.style.display = 'none';
    startScreenEl.style.display = 'block';
  });

  launchConfetti();
}

function launchConfetti() {
  // Use canvas-confetti library for confetti animation
  if (!window.confetti) return;

  const duration = 4 * 1000;
  const animationEnd = Date.now() + duration;
  const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };

  (function frame() {
    const timeLeft = animationEnd - Date.now();

    if (timeLeft <= 0) return;

    const particleCount = 50 * (timeLeft / duration);
    window.confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));

    requestAnimationFrame(frame);
  })();
}
</script>
</body>
</html>
