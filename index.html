<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kharis Department Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
* { box-sizing: border-box; margin:0; padding:0; }
body {
  font-family: 'Quicksand', sans-serif;
  background: url('https://kharis.org/wp-content/uploads/2022/11/271239127_4868436629869265_1030465267411614205_n.jpg') center/cover no-repeat fixed;
  color:#fff; display:flex; justify-content:center; align-items:center; min-height:100vh; padding:2rem;
}
.container {
  max-width:700px; width:100%;
  background: rgba(60,19,97,0.85);
  border-radius: 20px; padding: 2rem 3rem; text-align:center;
  box-shadow:0 0 20px #8e24aaaa; display:flex; flex-direction:column;
}
h1 { font-family: 'Fredoka One', cursive; margin-bottom: 1.5rem; }
.question { font-family: 'Fredoka One', cursive; font-size:1.5rem; margin-bottom:1rem; }
input[type="text"] {
  padding: 12px; width: 80%; border-radius: 30px; border:none; font-size:1rem;
  margin-bottom: 1rem; text-align:center;
}
.btn {
  background: #ffd700; color: #3c1361;
  border: none; padding: 1rem 2rem; margin: 0.5rem;
  border-radius: 50px; font-size: 1.2rem; cursor: pointer;
  font-family: 'Fredoka One', cursive;
  transition: background 0.3s, color 0.3s; min-width: 140px;
}
.btn:hover { background: #6a1b9a; color: #ffd700; }
.back-btn {
  background: transparent; color: #ffd700;
  border: 2px solid #ffd700; padding: 0.6rem 1.4rem;
  border-radius: 30px; font-size: 1rem; cursor: pointer;
  font-family: 'Fredoka One', cursive; margin-top: 1rem;
}
.back-btn:hover { background: #ffd700; color: #3c1361; }
.result { font-size:1.2rem; margin-top:1rem; }
.confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
.department { font-family: 'Fredoka One', cursive; font-size:1.3rem; margin:0.5rem 0; }
</style>
</head>
<body>
<div class="container">
  <div id="start-screen">
    <h1>Are You Ready to Discover Your Department?</h1>
    <button class="btn" id="start-london">Kharis Church London</button>
    <button class="btn" id="start-kp2">KP2</button>
  </div>

  <div id="quiz" style="display:none;"></div>
  <button class="back-btn" id="back-btn" style="display:none;">&larr; Back</button>
  <div id="result" style="display:none;"></div>
  <canvas id="confetti-canvas" class="confetti"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
(() => {
const quizEl = document.getElementById("quiz");
const startScreenEl = document.getElementById("start-screen");
const resultEl = document.getElementById("result");
const backBtn = document.getElementById("back-btn");

let currentQuiz = null;
let currentQ = 0;
let questionHistory = [];
let deptScores = {};

// Free-text questions
const quizzes = {
  kp2: [
    { q:"Whatâ€™s your vibe on a weekend?" },
    { q:"Your friends describe you as.." },
    { q:"Describe how you naturally help or support people around you." },
    { q:"If you could lead something, what would it be and why?" }
  ],
  london: [
    { q:"When faced with chaos, what grounds you most?" },
    { q:"How do you prefer to impact others?" },
    { q:"In a group, you are the one who: for e.g(captures moments, greets, comforts)" },
    { q:"How do you love to serve in the Kingdom? for e.g(music, teach, welcome, poetry)" }
  ]
};

// Department keywords
const deptKeywords = {
  "Administration":["organise","plan","manage","admin","schedule"],
  "Children's Department":["children","kids","play","teach"],
  "Design":["creative","visual","art","design","draw"],
  "Drama":["act","perform","storytelling","drama"],
  "Evangelism":["share","bold","witness","evangelism","preach"],
  "Follow Up":["follow","mentor","support","guidance"],
  "Hospitality":["welcome","greet","friendly","hospitality"],
  "Host Team":["host","welcome","assist","greeter"],
  "K-Drama":["performance","stage","act","drama","energy"],
  "K-Music":["music","beats","rap","sound"],
  "Media":["camera","video","photos","media","tech"],
  "Music":["sing","play","instrument","worship","music"],
  "New Believers":["support","guide","mentor","newcomer","teach"],
  "Production":["sound","lights","tech","production"],
  "Sanctuary Keepers":["clean","organise","maintain","church"],
  "Security":["protect","safe","security","guard"],
  "Set-up":["setup","arrange","prepare","set-up"],
  "Ushers":["guide","assist","usher","welcome"],
  "Welfare":["help","serve","support","care","welfare"],
  "Spoken Word":["poetry","speak","words","spoken word"],
  "Social Media":["trends","post","social","online","media"],
  "Photography":["photo","picture","camera","photography"],
  "Uniform":["fashion","dress","team"],
  "Sound":["sound","microphone","volume","check","audio","speaker"]
};

function initScores() {
  deptScores = {};
  Object.keys(deptKeywords).forEach(d=>deptScores[d]=0);
}

function showQuestion() {
  const qObj = quizzes[currentQuiz][currentQ];
  quizEl.innerHTML = `
    <div class="question">${qObj.q}</div>
    <input type="text" id="answer" placeholder="Type your answer here...">
    <br>
    <button class="btn" onclick="nextQuestion()">Next</button>
  `;
  quizEl.style.display="block";
  startScreenEl.style.display="none";
  resultEl.style.display="none";
  backBtn.style.display = currentQ>0?"inline-block":"none";
}

// Improved scoring
function scoreAnswer(input) {
  input = input.toLowerCase();
  let matched = false;
  Object.entries(deptKeywords).forEach(([dept, keywords])=>{
    keywords.forEach(word=>{
      if(input.includes(word)) { deptScores[dept] += 2; matched = true; }
    });
  });
  if(!matched) {
    // Assign 2 relevant departments based on quiz type
    let relatedDepts = currentQuiz === "kp2" 
        ? ["Design","Drama","K-Music","Spoken Word","Social Media"] 
        : ["Design","Drama","Music","Photography","Production","Hospitality"];
    const shuffled = relatedDepts.sort(()=>0.5-Math.random());
    deptScores[shuffled[0]] += 1;
    deptScores[shuffled[1]] += 1;
  }
}

window.nextQuestion = function() {
  const input = document.getElementById("answer").value.trim();
  if(!input) { alert("Please type something!"); return; }

  questionHistory.push({q:currentQ, deptScores:{...deptScores}});

  if(["idk","i don't know","i dont know"].includes(input.toLowerCase())) {
    scoreAnswer(""); // treat like blank, assign relevant departments
  } else {
    scoreAnswer(input);
  }

  currentQ++;
  if(currentQ < quizzes[currentQuiz].length) showQuestion();
  else showResult();
}

backBtn.onclick = ()=> {
  if(questionHistory.length>0){
    const last = questionHistory.pop();
    currentQ = last.q;
    deptScores = last.deptScores;
    showQuestion();
  }
}

function showResult() {
  quizEl.style.display="none";
  resultEl.style.display="block";

  const sorted = Object.entries(deptScores).sort((a,b)=>b[1]-a[1]).slice(0,2);
  let html = `<h2>Your Top 2 Departments:</h2>`;
  sorted.forEach(([d])=> html += `<div class="department">${d}</div>`);
  html += `<button class="btn" onclick="restart()">Start Over</button>`;
  resultEl.innerHTML = html;

  if(typeof confetti!=="undefined") confetti({particleCount:150,spread:70,origin:{y:0.6}});
}

window.restart = function() {
  currentQ=0; questionHistory=[]; initScores();
  startScreenEl.style.display="block";
  quizEl.style.display="none";
  resultEl.style.display="none";
  backBtn.style.display="none";
}

document.getElementById("start-london").onclick = ()=>{
  currentQuiz="london"; currentQ=0; initScores(); showQuestion();
};
document.getElementById("start-kp2").onclick = ()=>{
  currentQuiz="kp2"; currentQ=0; initScores(); showQuestion();
};
})();
</script>
</body>
</html>
