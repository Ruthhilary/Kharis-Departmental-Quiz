<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kharis Department Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
* { box-sizing: border-box; margin:0; padding:0; transition: all 0.4s ease; }
body { font-family: 'Quicksand', sans-serif; background: var(--bg-img) center/cover no-repeat fixed; color: var(--text-color); display:flex; justify-content:center; align-items:center; min-height:100vh; padding:2rem; }
:root { --bg-img: url('https://kharis.org/wp-content/uploads/2022/11/271239127_4868436629869265_1030465267411614205_n.jpg'); --card-bg: rgba(60,19,97,0.85); --btn-bg: #ffd700; --btn-color: #3c1361; --text-color: #fff; }
body.light { --card-bg: rgba(255,255,255,0.9); --btn-bg: #3c1361; --btn-color: #ffd700; --text-color: #000; }
.container { max-width:700px; width:100%; background: var(--card-bg); border-radius: 20px; padding: 2rem 3rem; text-align:center; box-shadow:0 0 20px #8e24aaaa; display:flex; flex-direction:column; pointer-events:auto; }
h1 { font-family: 'Fredoka One', cursive; margin-bottom: 1.5rem; }
.question { font-family: 'Fredoka One', cursive; font-size:1.3rem; margin-bottom:1rem; }
.scripture { font-style: italic; font-size:0.95rem; margin-bottom:0.8rem; opacity:0.8; }
input[type="text"], select { padding: 14px; width: 90%; border-radius: 30px; border:none; font-size:1rem; margin-bottom: 1rem; text-align:center; background: rgba(255,255,255,0.9); color: #3c1361; }
select { cursor:pointer; appearance:none; -webkit-appearance:none; -moz-appearance:none; background-image: url("data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns='http://www.w3.org/2000/svg' width='14' height='14' viewBox='0 0 24 24'%3E%3Cpath fill='%233c1361' d='M7 10l5 5 5-5H7z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 15px center; background-size: 14px; transition: box-shadow 0.3s ease; }
select:focus { outline:none; box-shadow:0 0 10px rgba(255,215,0,0.7); }
.btn { background: var(--btn-bg); color: var(--btn-color); border: none; padding: 1rem 2rem; margin: 0.5rem auto; border-radius: 50px; font-size: 1.1rem; cursor: pointer; font-family: 'Fredoka One', cursive; transition: background 0.3s, color 0.3s; width:90%; }
.btn:hover { background: #6a1b9a; color: #ffd700; }
.back-btn { background: transparent; color: var(--btn-bg); border: 2px solid var(--btn-bg); padding: 0.6rem 1.4rem; border-radius: 30px; font-size: 1rem; cursor: pointer; font-family: 'Fredoka One', cursive; margin-top: 1rem; }
.back-btn:hover { background: var(--btn-bg); color: var(--btn-color); }
.result { font-size:1.2rem; margin-top:1rem; }
.confetti { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
.department { font-family: 'Fredoka One', cursive; font-size:1.3rem; margin:0.5rem 0; opacity:0; transition: opacity 0.8s ease; }
.department.show { opacity:1; }
.scripture-box { background: rgba(255, 215, 0, 0.15); color: var(--text-color); border-left: 5px solid var(--btn-bg); padding: 10px 15px; margin: 5px 0 15px 0; border-radius: 10px; font-style: italic; text-align: left; opacity: 0; transform: translateY(20px); transition: opacity 1s ease, transform 1s ease; }
.scripture-box.show { opacity: 1; transform: translateY(0); }
.progress-bar { width: 100%; height: 12px; background: #ddd; border-radius: 20px; margin: 15px 0; }
.progress { height: 100%; width: 0%; background: #ffd700; border-radius: 20px; transition: width 0.4s ease; }
.toggle-mode { position:absolute; top:15px; right:15px; background:transparent; border:2px solid var(--btn-bg); color:var(--btn-bg); padding:5px 12px; border-radius:20px; cursor:pointer; font-size:0.9rem; }
.toggle-mode:hover { background: var(--btn-bg); color: var(--btn-color); }
@media(max-width:600px){ .container { padding:1.5rem; } .btn { font-size:1rem; padding:0.8rem; }}
</style>
</head>
<body>
<button class="toggle-mode" id="modeBtn">🌙</button>
<div class="container">
  <div id="start-screen">
    <h1>Are You Ready to Discover Your Department?</h1>
    <input type="text" id="username" placeholder="Enter your name" />
    <select id="branch">
      <option value="" disabled selected>Select your branch</option>
      <option>Kharis Church Accra</option>
      <option>Kharis Church Birmingham</option>
      <option>Kharis Church Brighton</option>
      <option>Kharis Church Bristol</option>
      <option>Kharis Church Chatham</option>
      <option>Kharis Church Chelmsford</option>
      <option>Kharis Church Coventry</option>
      <option>Kharis Church Croydon</option>
      <option>Kharis Church Freetown</option>
      <option>Kharis Church London</option>
      <option>Kharis Church Luton</option>
      <option>Kharis Church Manchester</option>
      <option>Kharis Church Northampton</option>
      <option>Kharis Church Nottingham</option>
      <option>Kharis Church Orpington</option>
      <option>Kharis Church Reading</option>
      <option>Kharis Phase 2 Birmingham</option>
      <option>Kharis Phase 2 London</option>
      <option>Kharis Phase 2 Romford</option>
      <option>Kharis Phase 2 Southampton</option>
    </select>
    <button class="btn" id="start-kharis">Kharis</button>
  </div>

  <div id="quiz" style="display:none;"></div>
  <div class="progress-bar"><div class="progress" id="progress"></div></div>
  <button class="back-btn" id="back-btn" style="display:none;">&larr; Back</button>
  <div id="result" style="display:none;"></div>
  <canvas id="confetti-canvas" class="confetti"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
(() => {
const quizEl = document.getElementById("quiz");
const startScreenEl = document.getElementById("start-screen");
const resultEl = document.getElementById("result");
const backBtn = document.getElementById("back-btn");
const progressEl = document.getElementById("progress");

let username="", branch="", currentQuiz=null, currentQ=0;
let questionHistory=[], deptScores={}, traits={creative:0, organised:0, bold:0, servant:0}, answersGiven=[];

// Replace with your own sheet URL
const SHEET_URL = "https://script.google.com/macros/s/AKfycbxz0F4EoHusuSJ_e04shOtOrg9Hh8ijkSwgYQBE81yS7vD7p-6kUoOwj9P_mD5UcYNh/exec";

// --- Quizzes ---
const quizzes = { kharis:[
{ q:"When faced with chaos, what grounds you most?", s:"1 Corinthians 14:33 – For God is not a God of disorder but of peace." },
{ q:"How do you prefer to impact others?", s:"Matthew 5:16 – Let your light shine before others." },
{ q:"In a group, you are the one who...", s:"Romans 12:6 – We have different gifts, according to the grace given to each of us." },
{ q:"How do you love to serve in the Kingdom?", s:"Ephesians 6:7 – Serve wholeheartedly, as if you were serving the Lord." },
{ q:"If you could lead something, what would it be?", s:"Joshua 1:9 – Be strong and courageous." },
{ q:"When someone is hurting, what do you naturally do?", s:"2 Corinthians 1:4 – God comforts us… so we can comfort others." },
{ q:"What excites you most: creating, organising, helping, or sharing boldly?", s:"Colossians 3:23 – Whatever you do, work at it with all your heart." },
{ q:"If you had one talent to use for God, what would it be?", s:"1 Peter 4:10 – Each of you should use whatever gift you have received to serve others." }
]};

// --- Department data ---
const deptData = {
  "Administration": { desc: "Organised, detail-oriented, and dependable individuals who excel at planning, coordinating, and ensuring smooth operations.", scripture: "1 Corinthians 14:40 - 'But everything should be done in a fitting and orderly way.'" },
  "Children's Department": { desc: "Patient, nurturing, and joyful people who love teaching, encouraging, and inspiring children to grow in faith.", scripture: "Matthew 19:14 - 'Let the little children come to me, and do not hinder them, for the kingdom of heaven belongs to such as these.'" },
  "Design": { desc: "Creative, innovative, and visually-minded individuals who enjoy expressing ideas through graphics, layouts, and aesthetic design.", scripture: "Exodus 31:3-5 - 'And I have filled him with the Spirit of God, with wisdom, with understanding, with knowledge and with all kinds of skills—to make artistic designs for work in gold, silver and bronze, to cut and set stones, to work in wood, and to engage in all kinds of crafts.'" },
  "Drama": { desc: "Expressive, imaginative, and bold personalities who love storytelling, acting, and bringing biblical stories to life.", scripture: "Psalm 150:4 - 'Praise him with the sounding of the trumpet, praise him with the harp and lyre, praise him with timbrel and dancing.'" },
  "Hospitality": { desc: "Warm, welcoming, and generous-hearted people who enjoy serving, connecting with others, and creating a sense of belonging.", scripture: "Romans 12:13 - 'Share with the Lord’s people who are in need. Practice hospitality.'" },
  "Host Team": { desc: "Friendly, observant, and organised individuals who thrive in coordinating events and ensuring smooth experiences for guests.", scripture: "Hebrews 13:2 - 'Do not forget to show hospitality to strangers, for by so doing some people have shown hospitality to angels without knowing it.'" },
  "Music": { desc: "Passionate, expressive, and worshipful individuals who lead others in praise through music and inspire heartfelt worship.", scripture: "Psalm 95:1-2 - 'Come, let us sing for joy to the Lord; let us shout aloud to the Rock of our salvation. Let us come before him with thanksgiving and extol him with music and song.'" },
  "Follow Up": { desc: "Caring, attentive, and relational individuals who enjoy guiding new believers, building trust, and encouraging spiritual growth.", scripture: "Matthew 28:19 - 'Therefore go and make disciples of all nations, baptizing them in the name of the Father and of the Son and of the Holy Spirit.'" },
  "New Believers": { desc: "Patient, supportive, and mentoring-minded people who love helping others understand faith and grow spiritually.", scripture: "Colossians 1:28 - 'He is the one we proclaim, admonishing and teaching everyone with all wisdom, so that we may present everyone fully mature in Christ.'" },
  "Evangelism": { desc: "Bold, outgoing, and confident individuals who love sharing the gospel and engaging others with compassion and courage.", scripture: "Mark 16:15 - 'He said to them, “Go into all the world and preach the gospel to all creation.”'" },
  "Sanctuary Keepers": { desc: "Responsible, conscientious, and detail-focused people who take pride in maintaining a clean and orderly worship environment.", scripture: "1 Corinthians 3:16 - 'Don’t you know that you yourselves are God’s temple and that God’s Spirit dwells in your midst?'" },
  "Set-up": { desc: "Hands-on, practical, and solution-oriented individuals who enjoy preparing spaces, managing logistics, and problem-solving.", scripture: "Nehemiah 4:6 - 'So we rebuilt the wall till all of it reached half its height, for the people worked with all their heart.'" },
  "Social Media": { desc: "Creative, tech-savvy, and communicative personalities who enjoy storytelling and engaging communities online.", scripture: "Psalm 19:14 - 'May these words of my mouth and this meditation of my heart be pleasing in your sight, Lord, my Rock and my Redeemer.'" },
  "Sound": { desc: "Technically-minded, attentive, and precise individuals who thrive on managing audio and creating seamless sound experiences.", scripture: "1 Corinthians 14:7 - 'If even lifeless instruments give sounds, how will anyone know what is played?'" },
  "Uniform": { desc: "Meticulous, disciplined, and detail-oriented people who value presentation, consistency, and high standards.", scripture: "1 Timothy 4:12 - 'Don’t let anyone look down on you because you are young, but set an example for the believers in speech, in conduct, in love, in faith and in purity.'" },
  "Ushers": { desc: "Friendly, approachable, and service-minded individuals who enjoy guiding, assisting, and caring for people in practical ways.", scripture: "Hebrews 13:17 - 'Have confidence in your leaders and submit to their authority, because they keep watch over you as those who must give an account.'" },
  "Welfare": { desc: "Compassionate, empathetic, and generous-hearted people who are motivated to help those in need and provide support.", scripture: "Galatians 6:2 - 'Carry each other’s burdens, and in this way you will fulfill the law of Christ.'" },
  "Security": { desc: "Alert, responsible, and protective individuals who prioritise safety and ensure a secure environment for others.", scripture: "Proverbs 27:12 - 'The prudent see danger and take refuge, but the simple keep going and pay the penalty.'" }
};

// --- Keywords ---
const deptKeywords = {
  "Administration":["organise","plan","admin"],
  "Children's Department":["child","kids","children","youth"],
  "Design":["design","art","creative","graphic"],
  "Drama":["drama","act","performance","play"],
  "Hospitality":["welcome","serve","hospitality","help"],
  "Host Team":["host","coordinate","guide"],
  "Music":["sing","music","play","instrument"],
  "Follow Up":["connect","follow up","contact","message"],
  "New Believers":["teach","mentor","new believer"],
  "Evangelism":["share","evangelism","preach","gospel","bold"],
  "Sanctuary Keepers":["clean","maintain","space"],
  "Set-up":["setup","equipment","arrange"],
  "Social Media":["social","media","online","content"],
  "Sound":["audio","mic","speaker","sound"],
  "Uniform":["attire","uniform","clothes"],
  "Ushers":["guide","usher","assist"],
  "Welfare":["care","serve","help","support"],
  "Security":["protect","security","safe","safety"]
};

// --- Initialize Scores ---
function initScores(){ 
  Object.keys(deptKeywords).forEach(d=>deptScores[d]=0); 
  traits={creative:0, organised:0, bold:0, servant:0}; 
  answersGiven=[]; 
}

// --- Show Question ---
function showQuestion(){
  const qObj = quizzes[currentQuiz][currentQ];
  quizEl.innerHTML = `
    <div class="scripture">${qObj.s}</div>
    <div class="question">${qObj.q}</div>
    <input type="text" id="answer" placeholder="Type your answer here..."><br>
    <button class="btn" id="nextBtn">Next</button>
  `;
  quizEl.style.display="block";
  startScreenEl.style.display="none";
  resultEl.style.display="none";
  backBtn.style.display = currentQ>0?"inline-block":"none";
  progressEl.style.width = ((currentQ+1)/quizzes[currentQuiz].length*100)+"%";
  setTimeout(()=>{document.getElementById("nextBtn").addEventListener("click", nextQuestion)},10);
}

// --- Score Answer ---
function scoreAnswer(input){
  input = input.toLowerCase();
  if(input.includes("create")||input.includes("art")||input.includes("design")) traits.creative++;
  if(input.includes("organise")||input.includes("plan")||input.includes("arrange")) traits.organised++;
  if(input.includes("speak")||input.includes("lead")||input.includes("bold")) traits.bold++;
  if(input.includes("help")||input.includes("serve")||input.includes("care")) traits.servant++;

  Object.entries(deptKeywords).forEach(([dept,keywords])=>{
    if(dept==="Children's Department" && !["kharis church london","kharis london","london"].includes(branch.toLowerCase())) return;
    keywords.forEach(word=>{ if(input.includes(word)) deptScores[dept]+=2; });
  });
  answersGiven.push({question: quizzes[currentQuiz][currentQ].q, answer: input, scripture: quizzes[currentQuiz][currentQ].s});
}

// --- Next Question ---
function nextQuestion(){
  const input=document.getElementById("answer").value.trim();
  if(!input){ alert("Please type something!"); return; }
  questionHistory.push({q:currentQ, deptScores:JSON.parse(JSON.stringify(deptScores)), traits:JSON.parse(JSON.stringify(traits)), answersGiven:JSON.parse(JSON.stringify(answersGiven))});
  scoreAnswer(input);
  currentQ++;
  if(currentQ<quizzes[currentQuiz].length) showQuestion();
  else showResult();
}

// --- Back Button ---
backBtn.addEventListener("click", ()=>{
  if(questionHistory.length>0){
    const last=questionHistory.pop();
    currentQ=last.q; deptScores=last.deptScores; traits=last.traits; answersGiven=last.answersGiven;
    showQuestion();
  }
});

// --- Show Result with Continue Feature ---
function showResult(){
  quizEl.style.display="none"; resultEl.style.display="block";

  if(traits.creative>traits.organised) deptScores["Design"]+=2;
  if(traits.organised>traits.creative) deptScores["Administration"]+=2;
  if(traits.bold>traits.servant) deptScores["Evangelism"]+=2;
  if(traits.servant>traits.bold) deptScores["Welfare"]+=2;

  const sorted=Object.entries(deptScores).filter(([d,s])=>s>0).sort((a,b)=>b[1]-a[1]).slice(0,2);
  let html=`<h2>${username} (${branch}), Your Top 2 Departments:</h2>`;
  sorted.forEach(([d],i)=>{
    html+=`<div class="department" id="dept-${i}"><strong>${d}</strong><div class="scripture-box" id="scripture-${i}">${deptData[d].desc}<br><strong>Scripture:</strong> ${deptData[d].scripture}</div></div>`;
  });

  // Fun continue section
  html+=`
  <div class="scripture-box" style="opacity:1; transform:translateY(0); margin-top:20px; background: rgba(255,215,0,0.1);">
    <strong>Curious to see more?</strong> Discover all the amazing departments at Kharis Church and find where your heart might want to explore next! 🎉
  </div>
  <button class="btn" id="explore-btn">Continue to Explore</button>
  <button class="btn" onclick="restart()">Start Over</button>
  `;

  resultEl.innerHTML=html;

  if(typeof confetti!=="undefined") confetti({particleCount:150,spread:70,origin:{y:0.6}});
  sorted.forEach((_,i)=>{ setTimeout(()=>{ document.getElementById(`dept-${i}`).classList.add("show"); setTimeout(()=>document.getElementById(`scripture-${i}`).classList.add("show"),500); },i*1000); });

  saveResult();

  // Explore all departments event
  document.getElementById("explore-btn").addEventListener("click", ()=>{
    let exploreHtml="<h2>All Kharis Departments 🎨🎵🛠️</h2>";
    Object.entries(deptData).forEach(([dept,info],i)=>{
      exploreHtml+=`<div class="department" id="explore-${i}"><strong>${dept}</strong>: ${info.desc}</div>`;
    });
    exploreHtml+=`<button class="btn" onclick="restart()">Back to Start</button>`;
    resultEl.innerHTML=exploreHtml;
    // Animate departments
    Object.keys(deptData).forEach((_,i)=>{
      setTimeout(()=>document.getElementById(`explore-${i}`).classList.add("show"), i*200);
    });
  });
}

// --- Restart ---
window.restart = function(){
  currentQ=0; questionHistory=[]; initScores();
  startScreenEl.style.display="block"; quizEl.style.display="none"; resultEl.style.display="none"; backBtn.style.display="none"; progressEl.style.width="0%";
}

// --- Save Result ---
function saveResult(){
  const sorted=Object.entries(deptScores).sort((a,b)=>b[1]-a[1]).slice(0,2);
  const top1=sorted[0]?sorted[0][0]:""; const top2=sorted[1]?sorted[1][0]:"";
  const today=new Date(); const dateString=today.toLocaleDateString("en-GB",{day:"2-digit", month:"2-digit", year:"numeric"});
  fetch(SHEET_URL,{method:"POST",body:JSON.stringify({fullName:username, branch:branch, topDept1:top1, topDept2:top2, date:dateString, answers:answersGiven}),headers:{"Content-Type":"application/json"},mode:"no-cors"})
  .then(()=>console.log("✅ Results autosaved")).catch(err=>console.error("❌ Error saving results",err));
}

// --- Start Quiz ---
document.getElementById("start-kharis").addEventListener("click", ()=>{
  username=document.getElementById("username").value.trim()||"Friend";
  branch=document.getElementById("branch").value;
  if(!branch){ alert("Please select your branch."); return; }
  currentQuiz="kharis"; currentQ=0; initScores(); showQuestion();
});

// --- Toggle Light/Dark ---
document.getElementById("modeBtn").addEventListener("click", ()=>{
  document.body.classList.toggle("light");
  document.getElementById("modeBtn").textContent=document.body.classList.contains("light")?"☀️":"🌙";
});
})();
</script>
</body>
</html>
