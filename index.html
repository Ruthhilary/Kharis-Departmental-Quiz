<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kharis Department Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
  * {
    box-sizing: border-box; margin: 0; padding: 0;
  }
  body {
    font-family: 'Quicksand', sans-serif;
    background: url('https://kharis.org/wp-content/uploads/2022/11/271239127_4868436629869265_1030465267411614205_n.jpg') center/cover no-repeat fixed;
    color: #fff;
    overflow-x: hidden;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem;
  }
  .container {
    max-width: 700px;
    width: 100%;
    background: rgba(60,19,97,0.85);
    border-radius: 20px;
    padding: 2rem 3rem;
    text-align: center;
    box-shadow: 0 0 20px #8e24aaaa;
    animation: fadeIn 1s ease forwards;
    position: relative;
    display: flex;
    flex-direction: column;
  }
  h1, h2, h3 {
    font-family: 'Fredoka One', cursive;
    margin-bottom: 1.5rem;
  }
  .btn {
    background: #fff;
    color: #6a1b9a;
    border: none;
    padding: 1rem 2rem;
    margin: 1rem 0.5rem;
    border-radius: 50px;
    font-size: 1.2rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    transition: background 0.3s, color 0.3s;
    min-width: 140px;
    user-select: none;
  }
  .btn:hover, .btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .question {
    font-size: 1.9rem;
    margin-bottom: 2rem;
  }
  .answers {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .answers button {
    background: #6a1b9a;
    color: #fff;
    border: none;
    padding: 1rem 1.5rem;
    border-radius: 30px;
    font-size: 1.1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    user-select: none;
    transition: background 0.3s;
  }
  .answers button:hover, .answers button:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .result h2 {
    margin-bottom: 2rem;
    font-size: 2.5rem;
  }
  .result .department {
    font-size: 1.8rem;
    margin: 1rem 0 0.5rem;
    font-weight: bold;
  }
  .result .description {
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
  }
  .result .home-btn, .result .another-btn {
    margin-top: 1rem;
    background: #ffd700;
    color: #3c1361;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    min-width: 160px;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  .result .home-btn:hover, .result .home-btn:focus, 
  .result .another-btn:hover, .result .another-btn:focus {
    background: #6a1b9a;
    color: #ffd700;
    outline: none;
  }
  .back-btn {
    background: transparent;
    color: #ffd700;
    border: 2px solid #ffd700;
    padding: 0.6rem 1.4rem;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    user-select: none;
    transition: background 0.3s, color 0.3s;
    align-self: center;
    margin-top: 1rem;
    width: max-content;
  }
  .back-btn:hover, .back-btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .confetti {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }
  /* Responsive styles for tablets and iPads */
  @media (max-width: 1024px) {
    .container { padding: 1.5rem 2rem; }
    .question { font-size: 1.6rem; }
    .btn { font-size: 1rem; padding: 0.8rem 1.5rem; }
    .result h2 { font-size: 2rem; }
    .result .department { font-size: 1.5rem; }
    .result .description { font-size: 1rem; }
    .result .home-btn, .result .another-btn, .back-btn { font-size: 0.9rem; padding: 0.6rem 1.2rem; }
  }
  /* Responsive styles for smaller tablets and iPads in portrait */
  @media (max-width: 768px) {
    .container { padding: 1.2rem 1.5rem; }
    .question { font-size: 1.4rem; }
    .btn { font-size: 0.95rem; padding: 0.7rem 1.2rem; }
    .result h2 { font-size: 1.8rem; }
    .result .department { font-size: 1.3rem; }
    .result .description { font-size: 0.95rem; }
  }
</style>
</head>
<body>
<div class="container" role="main" aria-live="polite" aria-atomic="true">
  <!-- Start Screen -->
  <div class="start-screen" id="start-screen">
    <h1>Are You Ready to Discover Your Place?</h1>
    <button class="btn" id="start-london" aria-label="Start quiz for Kharis Church London">Kharis Church London</button>
    <button class="btn" id="start-kp2" aria-label="Start quiz for KP2">KP2</button>
  </div>
  <!-- Quiz Questions Section -->
  <div class="question-section" id="quiz" style="display:none;" aria-live="polite" aria-atomic="true"></div>
  <!-- Back Button -->
  <button class="back-btn" id="back-btn" style="display:none;" aria-label="Go back to previous question">&larr; Back</button>
  <!-- Result Screen -->
  <div class="result" id="result" style="display:none;" aria-live="polite" aria-atomic="true"></div>
  <!-- Confetti Canvas -->
  <canvas id="confetti-canvas" class="confetti"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
(() => {
  const quizEl = document.getElementById('quiz');
  const startScreenEl = document.getElementById('start-screen');
  const resultEl = document.getElementById('result');
  const backBtn = document.getElementById('back-btn');
  const confettiCanvas = document.getElementById('confetti-canvas');

  // Confetti instance
  const confettiInstance = confettiCanvas && confettiCanvas.getContext ? window.confetti : null;

  // Quiz questions for each version
  const questions = {
    london: [
      {
        question: "When faced with chaos, what grounds you most?",
        answers: [
          { text: "A plan", dept: "Administration" },
          { text: "A calm presence", dept: "Welfare" },
          { text: "Creative expression", dept: "Design" },
          { text: "Leadership and direction", dept: "Host Team" },
        ],
      },
      {
        question: "Which activity energizes you?",
        answers: [
          { text: "Teaching children", dept: "Children's Department" },
          { text: "Producing visual content", dept: "Design" },
          { text: "Welcoming new people", dept: "Hospitality" },
          { text: "Organizing events", dept: "Administration" },
        ],
      },
      {
        question: "Your communication style is:",
        answers: [
          { text: "Expressive and creative", dept: "Drama" },
          { text: "Clear and concise", dept: "Sound" },
          { text: "Warm and friendly", dept: "Ushers" },
          { text: "Encouraging and supportive", dept: "Follow Up" },
        ],
      },
      {
        question: "What role do you enjoy most in a team?",
        answers: [
          { text: "The performer", dept: "Drama" },
          { text: "The organizer", dept: "Administration" },
          { text: "The supporter", dept: "Welfare" },
          { text: "The tech specialist", dept: "Production" },
        ],
      },
      {
        question: "How do you express your faith creatively?",
        answers: [
          { text: "Through music", dept: "Music" },
          { text: "Through art and design", dept: "Design" },
          { text: "Through drama", dept: "Drama" },
          { text: "Through media and social media", dept: "Social Media" },
        ],
      },
      {
        question: "You prefer to serve by:",
        answers: [
          { text: "Helping new believers grow", dept: "New Believers" },
          { text: "Practical setup and maintenance", dept: "Set-up" },
          { text: "Security and safety", dept: "Security" },
          { text: "Welcoming guests", dept: "Hospitality" },
        ],
      },
      {
        question: "What gives you the most satisfaction in service?",
        answers: [
          { text: "Helping others feel welcome", dept: "Ushers" },
          { text: "Supporting leadership", dept: "Administration" },
          { text: "Praying and caring for needs", dept: "Welfare" },
          { text: "Technical excellence", dept: "Sound" },
        ],
      },
      {
        question: "You’re most passionate about:",
        answers: [
          { text: "Evangelism and outreach", dept: "Evangelism" },
          { text: "Sanctuary care and upkeep", dept: "Sanctuary Keepers" },
          { text: "Producing engaging media", dept: "Production" },
          { text: "Creating welcoming environments", dept: "Hospitality" },
        ],
      },
    ],
    kp2: [
      {
        question: "What’s your vibe when you walk into a room?",
        answers: [
          { text: "I bring energy and fun", dept: "K-Drama" },
          { text: "I’m all about music", dept: "K-Music" },
          { text: "I love helping people", dept: "Welfare" },
          { text: "I’m a social media whizz", dept: "Social Media" },
        ],
      },
      {
        question: "If you could lead, you would:",
        answers: [
          { text: "Organize the coolest events", dept: "Administration" },
          { text: "Host and welcome everyone", dept: "Host Team" },
          { text: "Help friends follow up with newcomers", dept: "Follow Up" },
          { text: "Keep everything running smoothly", dept: "Set-up" },
        ],
      },
      {
        question: "How do you express yourself best?",
        answers: [
          { text: "Through acting and drama", dept: "K-Drama" },
          { text: "By creating awesome visuals", dept: "Design" },
          { text: "Through music and singing", dept: "K-Music" },
          { text: "By sharing online", dept: "Social Media" },
        ],
      },
      {
        question: "What’s your favourite way to serve?",
        answers: [
          { text: "Greeting and ushering", dept: "Ushers" },
          { text: "Praying for and caring for others", dept: "Welfare" },
          { text: "Running sound and tech", dept: "Sound" },
          { text: "Keeping security", dept: "Security" },
        ],
      },
      {
        question: "Your ideal project is:",
        answers: [
          { text: "Putting on a drama show", dept: "K-Drama" },
          { text: "Composing and performing music", dept: "K-Music" },
          { text: "Designing posters and flyers", dept: "Design" },
          { text: "Managing social media content", dept: "Social Media" },
        ],
      },
      {
        question: "You get the most satisfaction from:",
        answers: [
          { text: "Seeing people grow in faith", dept: "New Believers" },
          { text: "Helping with event logistics", dept: "Administration" },
          { text: "Welcoming newcomers warmly", dept: "Hospitality" },
          { text: "Helping people feel safe", dept: "Security" },
        ],
      },
      {
        question: "Which would you rather do?",
        answers: [
          { text: "Sing on stage", dept: "K-Music" },
          { text: "Help people find their way", dept: "Host Team" },
          { text: "Create cool graphics", dept: "Design" },
          { text: "Manage sound and production", dept: "Sound" },
        ],
      },
      {
        question: "Your biggest strength is:",
        answers: [
          { text: "Creativity", dept: "K-Drama" },
          { text: "Technical skills", dept: "Sound" },
          { text: "People skills", dept: "Hospitality" },
          { text: "Organizational skills", dept: "Administration" },
        ],
      },
    ],
  };

  // Department descriptions for showing on results
  const departmentDescriptions = {
    "Administration": "Organize and manage church operations and events.",
    "Children's Department": "Teach and nurture children in their faith.",
    "Design": "Create visuals and designs for church materials and media.",
    "Drama": "Act and produce plays to share messages creatively.",
    "Follow Up": "Connect and support new members on their journey.",
    "Hospitality": "Welcome and serve guests with warmth and kindness.",
    "Host Team": "Lead and guide people through church services.",
    "K-Drama": "Express faith through drama and performance arts.",
    "K-Music": "Lead worship through singing and instruments.",
    "Media": "Produce and manage media content and presentations.",
    "Music": "Lead and perform music in church worship.",
    "New Believers": "Help newcomers grow and learn about faith.",
    "Production": "Manage sound, lighting, and technical production.",
    "Sanctuary Keepers": "Care for and maintain the sanctuary space.",
    "Set-up": "Prepare and maintain facilities and equipment.",
    "Social Media": "Create engaging content to connect online.",
    "Sound": "Manage audio equipment and sound quality.",
    "Ushers": "Greet and assist attendees during services.",
    "Uniform": "Coordinate volunteer uniforms and presentation.",
    "Welfare": "Provide care and support for those in need.",
    "Security": "Ensure safety and security during events.",
    "K-Drama": "Engage youth through drama and storytelling.",
  };

  let currentQuiz = null;  // 'london' or 'kp2'
  let currentQuestionIndex = 0;
  let scores = {};
  const totalQuestions = 8; // Both quizzes have 8 questions

  function initScores() {
    scores = {};
    // Get all possible departments for current quiz and set their scores to zero
    const allDepts = new Set();
    questions[currentQuiz].forEach(q =>
      q.answers.forEach(a => allDepts.add(a.dept))
    );
    allDepts.forEach(d => (scores[d] = 0));
  }

  // Show start screen, hide quiz/result/back button
  function showStartScreen() {
    startScreenEl.style.display = 'block';
    quizEl.style.display = 'none';
    resultEl.style.display = 'none';
    backBtn.style.display = 'none';
    clearConfetti();
  }

  // Start the quiz for chosen version
  function startQuiz(quizType) {
    currentQuiz = quizType;
    currentQuestionIndex = 0;
    initScores();
    startScreenEl.style.display = 'none';
    resultEl.style.display = 'none';
    backBtn.style.display = 'none';
    quizEl.style.display = 'block';
    showQuestion();
  }

  // Show the current question and answers
  function showQuestion() {
    const qObj = questions[currentQuiz][currentQuestionIndex];
    quizEl.innerHTML = `
      <div class="question">${qObj.question}</div>
      <div class="answers" role="list">
        ${qObj.answers.map(
          (ans, i) =>
            `<button class="answer-btn" role="listitem" data-dept="${ans.dept}" data-index="${i}" aria-label="${ans.text}">${ans.text}</button>`
        ).join('')}
      </div>
    `;
    // Show back button if not first question
    backBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';

    // Add event listeners to answers
    document.querySelectorAll('.answer-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const dept = btn.getAttribute('data-dept');
        scores[dept]++;
        currentQuestionIndex++;
        if (currentQuestionIndex < totalQuestions) {
          showQuestion();
        } else {
          showResult();
        }
      });
    });
  }

  // Go back to previous question
  backBtn.addEventListener('click', () => {
    if (currentQuestionIndex > 0) {
      currentQuestionIndex--;
      // We need to decrease score for previous answer:
      // However, without tracking history, this is complex.
      // So for simplicity, restart scores and recalc:
      recalcScoresUpTo(currentQuestionIndex);
      showQuestion();
    }
  });

  // We need to track selected answers history for accurate back button scoring:
  let answerHistory = [];

  // Modified showQuestion and answer click logic to track answers:

  function showQuestion() {
    const qObj = questions[currentQuiz][currentQuestionIndex];
    quizEl.innerHTML = `
      <div class="question">${qObj.question}</div>
      <div class="answers" role="list">
        ${qObj.answers.map(
          (ans, i) =>
            `<button class="answer-btn" role="listitem" data-dept="${ans.dept}" data-index="${i}" aria-label="${ans.text}">${ans.text}</button>`
        ).join('')}
      </div>
    `;
    backBtn.style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';

    document.querySelectorAll('.answer-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const dept = btn.getAttribute('data-dept');
        // Save answer
        answerHistory[currentQuestionIndex] = dept;
        // Recalculate scores based on answers so far
        recalcScoresUpTo(currentQuestionIndex + 1);
        currentQuestionIndex++;
        if (currentQuestionIndex < totalQuestions) {
          showQuestion();
        } else {
          showResult();
        }
      });
    });
  }

  // Recalculate scores based on answerHistory up to given question count
  function recalcScoresUpTo(qCount) {
    initScores();
    for (let i = 0; i < qCount; i++) {
      const dept = answerHistory[i];
      if (dept) scores[dept]++;
    }
  }

  // Show result screen with department recommendation(s)
  function showResult() {
    quizEl.style.display = 'none';
    backBtn.style.display = 'none';
    resultEl.style.display = 'block';
    clearConfetti();
    const maxScore = Math.max(...Object.values(scores));
    const topDepts = Object.keys(scores).filter(d => scores[d] === maxScore);

    // Build result HTML
    let resultHTML = `<h2>Your ideal department${topDepts.length > 1 ? 's' : ''} to serve in:</h2><ul>`;
    topDepts.forEach(dept => {
      const desc = departmentDescriptions[dept] || "Description coming soon.";
      resultHTML += `<li><strong>${dept}</strong>: ${desc}</li>`;
    });
    resultHTML += '</ul><button id="restart-btn">Take the quiz again</button>';

    resultEl.innerHTML = resultHTML;

    // Confetti effect (simple version)
    startConfetti();

    // Restart button event
    document.getElementById('restart-btn').addEventListener('click', () => {
      showStartScreen();
    });
  }

  // Confetti functions (simple canvas confetti)

  let confettiInterval = null;
  function startConfetti() {
    if (confettiInterval) return;
    const confettiColors = ['#00A1FF', '#FF0044', '#FFB700', '#00FF00', '#FF00FF'];
    const canvas = document.createElement('canvas');
    canvas.id = 'confetti-canvas';
    canvas.style.position = 'fixed';
    canvas.style.top = 0;
    canvas.style.left = 0;
    canvas.style.width = '100vw';
    canvas.style.height = '100vh';
    canvas.style.pointerEvents = 'none';
    canvas.style.zIndex = 9999;
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const pieces = [];
    const numPieces = 150;
    for (let i = 0; i < numPieces; i++) {
      pieces.push({
        x: Math.random() * canvas.width,
        y: Math.random() * canvas.height - canvas.height,
        r: Math.random() * 6 + 4,
        d: Math.random() * numPieces,
        color: confettiColors[Math.floor(Math.random() * confettiColors.length)],
        tilt: Math.floor(Math.random() * 10) - 10,
        tiltAngleIncremental: (Math.random() * 0.07) + 0.05,
        tiltAngle: 0,
      });
    }

    let angle = 0;
    confettiInterval = setInterval(() => {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      angle += 0.01;
      for (let i = 0; i < numPieces; i++) {
        const p = pieces[i];
        p.tiltAngle += p.tiltAngleIncremental;
        p.y += (Math.cos(angle + p.d) + 3 + p.r / 2) / 2;
        p.x += Math.sin(angle);
        p.tilt = Math.sin(p.tiltAngle) * 15;

        ctx.beginPath();
        ctx.lineWidth = p.r / 2;
        ctx.strokeStyle = p.color;
        ctx.moveTo(p.x + p.tilt + p.r / 4, p.y);
        ctx.lineTo(p.x + p.tilt, p.y + p.tilt + p.r / 4);
        ctx.stroke();

        if (p.y > canvas.height) {
          p.x = Math.random() * canvas.width;
          p.y = -10;
        }
      }
    }, 20);
  }

  function clearConfetti() {
    if (confettiInterval) {
      clearInterval(confettiInterval);
      confettiInterval = null;
      const canvas = document.getElementById('confetti-canvas');
      if (canvas) document.body.removeChild(canvas);
    }
  }

  // Initial screen
  showStartScreen();

  // Expose startQuiz to global scope for buttons
  window.startQuiz = startQuiz;

})();</script>
</body>
</html>
