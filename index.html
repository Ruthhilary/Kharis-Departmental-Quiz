<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kharis Department Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
  * {
    box-sizing: border-box; margin: 0; padding: 0;
  }
  body {
    font-family: 'Quicksand', sans-serif;
    background: url('https://kharis.org/wp-content/uploads/2022/11/271239127_4868436629869265_1030465267411614205_n.jpg') center/cover no-repeat fixed;
    color: #fff;
    overflow-x: hidden;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem;
  }
  .container {
    max-width: 700px;
    width: 100%;
    background: rgba(60,19,97,0.85);
    border-radius: 20px;
    padding: 2rem 3rem;
    text-align: center;
    box-shadow: 0 0 20px #8e24aaaa;
    animation: fadeIn 1s ease forwards;
    position: relative;
    display: flex;
    flex-direction: column;
  }
  h1, h2, h3 {
    font-family: 'Fredoka One', cursive;
    margin-bottom: 1.5rem;
  }
  .btn {
    background: #fff;
    color: #6a1b9a;
    border: none;
    padding: 1rem 2rem;
    margin: 1rem 0.5rem;
    border-radius: 50px;
    font-size: 1.2rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    transition: background 0.3s, color 0.3s;
    min-width: 140px;
    user-select: none;
  }
  .btn:hover, .btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .question {
    font-size: 1.9rem;
    margin-bottom: 2rem;
  }
  .answers {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .answers button {
    background: #6a1b9a;
    color: #fff;
    border: none;
    padding: 1rem 1.5rem;
    border-radius: 30px;
    font-size: 1.1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    user-select: none;
    transition: background 0.3s;
  }
  .answers button:hover, .answers button:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .result h2 {
    margin-bottom: 2rem;
    font-size: 2.5rem;
  }
  .result .department {
    font-size: 1.8rem;
    margin: 1rem 0 0.5rem;
    font-weight: bold;
  }
  .result .description {
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
  }
  .result .home-btn, .result .another-btn {
    margin-top: 1rem;
    background: #ffd700;
    color: #3c1361;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    min-width: 160px;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  .result .home-btn:hover, .result .home-btn:focus, 
  .result .another-btn:hover, .result .another-btn:focus {
    background: #6a1b9a;
    color: #ffd700;
    outline: none;
  }
  .back-btn {
    background: transparent;
    color: #ffd700;
    border: 2px solid #ffd700;
    padding: 0.6rem 1.4rem;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    user-select: none;
    transition: background 0.3s, color 0.3s;
    align-self: center;
    margin-top: 1rem;
    width: max-content;
  }
  .back-btn:hover, .back-btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .confetti {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }
  /* Responsive styles for tablets and iPads */
  @media (max-width: 1024px) {
    .container { padding: 1.5rem 2rem; }
    .question { font-size: 1.6rem; }
    .btn { font-size: 1rem; padding: 0.8rem 1.5rem; }
    .result h2 { font-size: 2rem; }
    .result .department { font-size: 1.5rem; }
    .result .description { font-size: 1rem; }
    .result .home-btn, .result .another-btn, .back-btn { font-size: 0.9rem; padding: 0.6rem 1.2rem; }
  }
  /* Responsive styles for smaller tablets and iPads in portrait */
  @media (max-width: 768px) {
    .container { padding: 1.2rem 1.5rem; }
    .question { font-size: 1.4rem; }
    .btn { font-size: 0.95rem; padding: 0.7rem 1.2rem; }
    .result h2 { font-size: 1.8rem; }
    .result .department { font-size: 1.3rem; }
    .result .description { font-size: 0.95rem; }
  }
</style>
</head>
<body>
<div class="container" role="main" aria-live="polite" aria-atomic="true">
  <!-- Start Screen -->
  <div class="start-screen" id="start-screen">
    <h1>Are You Ready to Discover Your Place?</h1>
    <button class="btn" id="start-london" aria-label="Start quiz for Kharis Church London">Kharis Church London</button>
    <button class="btn" id="start-kp2" aria-label="Start quiz for KP2">KP2</button>
  </div>
  <!-- Quiz Questions Section -->
  <div class="question-section" id="quiz" style="display:none;" aria-live="polite" aria-atomic="true"></div>
  <!-- Back Button -->
  <button class="back-btn" id="back-btn" style="display:none;" aria-label="Go back to previous question">&larr; Back</button>
  <!-- Result Screen -->
  <div class="result" id="result" style="display:none;" aria-live="polite" aria-atomic="true"></div>
  <!-- Confetti Canvas -->
  <canvas id="confetti-canvas" class="confetti"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
(() => {
  const quizEl = document.getElementById('quiz');
  const startScreenEl = document.getElementById('start-screen');
  const resultEl = document.getElementById('result');
  const backBtn = document.getElementById('back-btn');
  const confettiCanvas = document.getElementById('confetti-canvas');

  // Confetti instance
  const confettiInstance = confettiCanvas && confettiCanvas.getContext ? window.confetti : null;

  // Quiz questions for each version
  const questions = {
    london: [
      {
        question: "When faced with chaos, what grounds you most?",
        answers: [
          { text: "A plan", dept: "Administration" },
          { text: "A calm presence", dept: "Welfare" },
          { text: "Creative expression", dept: "Design" },
          { text: "Leadership and direction", dept: "Host Team" }
        ]
      },
      {
        question: "What energizes you the most?",
        answers: [
          { text: "Engaging children with stories and fun", dept: "Children's Department" },
          { text: "Setting up the sanctuary and environment", dept: "Set-up" },
          { text: "Organizing outreach events", dept: "Evangelism" },
          { text: "Helping with sound and music", dept: "Sound" }
        ]
      },
      {
        question: "How do you prefer to serve in worship?",
        answers: [
          { text: "Singing and leading songs", dept: "Music" },
          { text: "Helping with production and tech", dept: "Production" },
          { text: "Coordinating hospitality and welcoming", dept: "Hospitality" },
          { text: "Welcoming guests at doors", dept: "Ushers" }
        ]
      },
      {
        question: "What role would you enjoy most in the church community?",
        answers: [
          { text: "Follow up with new believers", dept: "Follow Up" },
          { text: "Performing drama during services", dept: "Drama" },
          { text: "Managing social media and outreach", dept: "Social Media" },
          { text: "Maintaining uniforms and presentation", dept: "Uniform" }
        ]
      }
    ],
    kp2: [
      {
        question: "What vibe fits you best on a Sunday?",
        answers: [
          { text: "Energetic and welcoming", dept: "Host Team" },
          { text: "Creative and artistic", dept: "K-Drama" },
          { text: "Music and rhythm", dept: "K-Music" },
          { text: "Helping others and caring", dept: "Welfare" }
        ]
      },
      {
        question: "Which activity would you be most excited to join?",
        answers: [
          { text: "Social media and making cool content", dept: "Social Media" },
          { text: "Setting up equipment and tech", dept: "Sound" },
          { text: "Helping new people feel at home", dept: "Follow Up" },
          { text: "Making sure everything runs smoothly", dept: "Administration" }
        ]
      },
      {
        question: "Pick the best way to serve others",
        answers: [
          { text: "Running games and kids' activities", dept: "Children's Department" },
          { text: "Welcoming and ushering", dept: "Ushers" },
          { text: "Being part of drama team", dept: "K-Drama" },
          { text: "Leading worship music", dept: "K-Music" }
        ]
      },
      {
        question: "What's your strongest skill?",
        answers: [
          { text: "Organizing and planning", dept: "Administration" },
          { text: "Making videos and graphics", dept: "Design" },
          { text: "Caring for people", dept: "Welfare" },
          { text: "Security and safety", dept: "Security" }
        ]
      }
    ]
  };

  // Departments descriptions for result display
  const departmentDescriptions = {
    // London Departments
    "Administration": "Keep everything running smoothly by organizing and coordinating church operations.",
    "Children's Department": "Bring joy and spiritual growth to children with engaging activities and care.",
    "Design": "Create beautiful visuals and media that inspire and communicate the church’s message.",
    "Drama": "Use storytelling and performance to bring the gospel to life.",
    "Hospitality": "Welcome guests warmly and ensure everyone feels at home.",
    "Host Team": "Lead and manage the flow of services and events with confidence.",
    "Production": "Handle the technical side like lighting and video for impactful worship.",
    "Music": "Lift the congregation with inspiring worship music and leading songs.",
    "Follow Up": "Help new believers grow and stay connected with the church family.",
    "New Believers": "Support those new in faith with guidance and care.",
    "Evangelism": "Spread the gospel by engaging with the community and sharing Christ.",
    "Sanctuary Keepers": "Maintain a sacred, clean, and orderly worship space.",
    "Set-up": "Prepare rooms and equipment for services and events.",
    "Social Media": "Share the church’s story online to reach many hearts.",
    "Sound": "Ensure excellent audio quality so everyone hears clearly.",
    "Uniform": "Maintain a professional and welcoming appearance for teams.",
    "Ushers": "Guide guests with a smile, helping them find their place.",
    "Welfare": "Provide care and practical support to those in need.",
    // KP2 Departments
    "K-Drama": "Bring stories to life through performance and creativity for youth.",
    "K-Music": "Lead vibrant worship tailored for younger hearts and voices.",
    "Security": "Keep everyone safe during gatherings and events."
  };

  let currentVersion = null;  // 'london' or 'kp2'
  let currentQuestionIndex = 0;
  let answersCount = {};
  let questionHistory = [];

  // Initialize answers count for departments
  function initAnswersCount(version) {
    answersCount = {};
    const depts = new Set();
    questions[version].forEach(q => q.answers.forEach(a => depts.add(a.dept)));
    depts.forEach(dept => answersCount[dept] = 0);
  }

  // Show start screen
  function showStart() {
    startScreenEl.style.display = 'block';
    quizEl.style.display = 'none';
    backBtn.style.display = 'none';
    resultEl.style.display = 'none';
    currentVersion = null;
    currentQuestionIndex = 0;
    questionHistory = [];
  }

  // Show a question by index
  function showQuestion(index) {
    const questionObj = questions[currentVersion][index];
    if (!questionObj) return;

    // Clear quiz area
    quizEl.innerHTML = '';

    // Question text
    const questionHeading = document.createElement('h2');
    questionHeading.className = 'question';
    questionHeading.textContent = questionObj.question;
    quizEl.appendChild(questionHeading);

    // Answers container
    const answersDiv = document.createElement('div');
    answersDiv.className = 'answers';

    // Create answer buttons
    questionObj.answers.forEach(({text, dept}, idx) => {
      const btn = document.createElement('button');
      btn.textContent = text;
      btn.setAttribute('aria-label', text + ', select to choose this answer');
      btn.addEventListener('click', () => {
        // Record answer
        answersCount[dept]++;
        questionHistory.push({ questionIndex: index, selectedDept: dept });
        currentQuestionIndex++;
        // Show next question or result
        if (currentQuestionIndex < questions[currentVersion].length) {
          showQuestion(currentQuestionIndex);
          backBtn.style.display = 'inline-block';
        } else {
          showResult();
          backBtn.style.display = 'none';
        }
      });
      answersDiv.appendChild(btn);
    });

    quizEl.appendChild(answersDiv);
    quizEl.style.display = 'block';

    // Show/hide back button
    if (index > 0) {
      backBtn.style.display = 'inline-block';
    } else {
      backBtn.style.display = 'none';
    }
  }

  // Show quiz result
  function showResult() {
    startScreenEl.style.display = 'none';
    quizEl.style.display = 'none';
    backBtn.style.display = 'none';
    resultEl.style.display = 'block';

    // Determine highest scored department(s)
    const maxScore = Math.max(...Object.values(answersCount));
    const topDepts = Object.entries(answersCount)
      .filter(([_, score]) => score === maxScore)
      .map(([dept]) => dept);

    // Pick one department if tie - pick first alphabetically
    topDepts.sort();
    const chosenDept = topDepts[0];

    // Build result HTML
    resultEl.innerHTML = `
      <h2>Your ideal department is:</h2>
      <div class="department">${chosenDept}</div>
      <div class="description">${departmentDescriptions[chosenDept] || "A special place to serve with your gifts."}</div>
      <button class="home-btn" id="restart-btn" aria-label="Restart the quiz">Try Again</button>
    `;

    // Confetti effect on result screen
    launchConfetti();

    // Restart button handler
    document.getElementById('restart-btn').addEventListener('click', () => {
      stopConfetti();
      showStart();
    });
  }

  // Launch confetti animation
  let confettiTimer = null;
  function launchConfetti() {
    if (!confetti) return;

    const duration = 5 * 1000;
    const end = Date.now() + duration;

    (function frame() {
      confetti({
        particleCount: 3,
        angle: 60,
        spread: 55,
        origin: { x: 0 },
        colors: ['#6a1b9a', '#ffd700', '#3c1361']
      });
      confetti({
        particleCount: 3,
        angle: 120,
        spread: 55,
        origin: { x: 1 },
        colors: ['#6a1b9a', '#ffd700', '#3c1361']
      });

      if (Date.now() < end) {
        confettiTimer = requestAnimationFrame(frame);
      }
    })();
  }

  function stopConfetti() {
    if (confettiTimer) {
      cancelAnimationFrame(confettiTimer);
      confettiTimer = null;
      confetti.reset();
    }
  }

  // Back button handler
  backBtn.addEventListener('click', () => {
    if (currentQuestionIndex === 0) return;

    // Undo last answer
    const lastAnswer = questionHistory.pop();
    if (lastAnswer) {
      answersCount[lastAnswer.selectedDept]--;
    }
    currentQuestionIndex--;
    showQuestion(currentQuestionIndex);

    // Hide back button if at first question
    if (currentQuestionIndex === 0) {
      backBtn.style.display = 'none';
    }
  });

  // Start buttons handlers
  document.getElementById('start-london').addEventListener('click', () => {
    currentVersion = 'london';
    initAnswersCount(currentVersion);
    startScreenEl.style.display = 'none';
    currentQuestionIndex = 0;
    questionHistory = [];
    showQuestion(currentQuestionIndex);
  });

  document.getElementById('start-kp2').addEventListener('click', () => {
    currentVersion = 'kp2';
    initAnswersCount(currentVersion);
    startScreenEl.style.display = 'none';
    currentQuestionIndex = 0;
    questionHistory = [];
    showQuestion(currentQuestionIndex);
  });

  // Show start screen initially
  showStart();

})();
</script>
</body>
</html>
