<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kharis Department Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Quicksand:wght@400;600&display=swap" rel="stylesheet" />
<style>
  * {
    box-sizing: border-box; margin: 0; padding: 0;
  }
  body {
    font-family: 'Quicksand', sans-serif;
    background: url('https://kharis.org/wp-content/uploads/2022/11/271239127_4868436629869265_1030465267411614205_n.jpg') center/cover no-repeat fixed;
    color: #fff;
    overflow-x: hidden;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 2rem;
  }
  .container {
    max-width: 700px;
    width: 100%;
    background: rgba(60,19,97,0.85);
    border-radius: 20px;
    padding: 2rem 3rem;
    text-align: center;
    box-shadow: 0 0 20px #8e24aaaa;
    animation: fadeIn 1s ease forwards;
    position: relative;
    display: flex;
    flex-direction: column;
  }
  h1, h2, h3 {
    font-family: 'Fredoka One', cursive;
    margin-bottom: 1.5rem;
  }
  .btn {
    background: #fff;
    color: #6a1b9a;
    border: none;
    padding: 1rem 2rem;
    margin: 1rem 0.5rem;
    border-radius: 50px;
    font-size: 1.2rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    transition: background 0.3s, color 0.3s;
    min-width: 140px;
    user-select: none;
  }
  .btn:hover, .btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .question {
    font-size: 1.9rem;
    margin-bottom: 2rem;
  }
  .answers {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }
  .result h2 {
    margin-bottom: 2rem;
    font-size: 2.5rem;
  }
  .result .department {
    font-size: 1.8rem;
    margin: 1rem 0 0.5rem;
    font-weight: bold;
  }
  .result .description {
    font-size: 1.2rem;
    margin-bottom: 1.5rem;
  }
  .result .home-btn, .result .another-btn {
    margin-top: 1rem;
    background: #ffd700;
    color: #3c1361;
    padding: 0.8rem 1.5rem;
    border: none;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    min-width: 160px;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  .result .home-btn:hover, .result .home-btn:focus, 
  .result .another-btn:hover, .result .another-btn:focus {
    background: #6a1b9a;
    color: #ffd700;
    outline: none;
  }
  .back-btn {
    background: transparent;
    color: #ffd700;
    border: 2px solid #ffd700;
    padding: 0.6rem 1.4rem;
    border-radius: 30px;
    font-size: 1rem;
    cursor: pointer;
    font-family: 'Fredoka One', cursive;
    user-select: none;
    transition: background 0.3s, color 0.3s;
    align-self: center;
    margin-top: 1rem;
    width: max-content;
  }
  .back-btn:hover, .back-btn:focus {
    background: #ffd700;
    color: #3c1361;
    outline: none;
  }
  .confetti {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 9999;
  }
  @keyframes fadeIn {
    from {opacity: 0; transform: translateY(20px);}
    to {opacity: 1; transform: translateY(0);}
  }
  /* Responsive styles for tablets and iPads */
  @media (max-width: 1024px) {
    .container { padding: 1.5rem 2rem; }
    .question { font-size: 1.6rem; }
    .btn { font-size: 1rem; padding: 0.8rem 1.5rem; }
    .result h2 { font-size: 2rem; }
    .result .department { font-size: 1.5rem; }
    .result .description { font-size: 1rem; }
    .result .home-btn, .result .another-btn, .back-btn { font-size: 0.9rem; padding: 0.6rem 1.2rem; }
  }
  /* Responsive styles for smaller tablets and iPads in portrait */
  @media (max-width: 768px) {
    .container { padding: 1.2rem 1.5rem; }
    .question { font-size: 1.4rem; }
    .btn { font-size: 0.95rem; padding: 0.7rem 1.2rem; }
    .result h2 { font-size: 1.8rem; }
    .result .department { font-size: 1.3rem; }
    .result .description { font-size: 0.95rem; }
  }
</style>
</head>
<body>
<div class="container" role="main" aria-live="polite" aria-atomic="true">
  <div class="start-screen" id="start-screen">
    <h1>Are You Ready to Discover Your Place?</h1>
    <button class="btn" id="start-london">Kharis Church London</button>
    <button class="btn" id="start-kp2">KP2</button>
  </div>
  <div class="question-section" id="quiz" style="display:none;"></div>
  <button class="back-btn" id="back-btn" style="display:none;" aria-label="Go back to previous question">&larr; Back</button>
  <div class="result" id="result" style="display:none;"></div>
  <canvas id="confetti-canvas" class="confetti"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
const quizEl = document.getElementById('quiz');
const startScreenEl = document.getElementById('start-screen');
const resultEl = document.getElementById('result');
const backBtn = document.getElementById('back-btn');
const confettiCanvas = document.getElementById('confetti-canvas');
const confettiInstance = confettiCanvas && confettiCanvas.getContext ? window.confetti : null;

const questions = {
  const questions = {
  london: [
    {
      question: "When faced with chaos, what grounds you most?",
      answers: [
        { text: "A plan", dept: "Administration" },
        { text: "A calm presence", dept: "Host Team" },
        { text: "A purpose", dept: "Evangelism" },
        { text: "A clear voice", dept: "Music" },
        { text: "A reset moment", dept: "Sanctuary Keepers" },
      ],
    },
    {
      question: "In conversations, what do you often find yourself doing most?",
      answers: [
        { text: "Listening for what’s not being said", dept: "Follow Up" },
        { text: "Offering clarity or solutions", dept: "Administration" },
        { text: "Making others feel comfortable", dept: "Hospitality" },
        { text: "Observing the energy in the room", dept: "Production" },
        { text: "Remembering the little details", dept: "Welfare" },
      ],
    },
    {
      question: "Which phrase resonates most with how you move through life?",
      answers: [
        { text: "“I anticipate before I act.”", dept: "Administration" },
        { text: "“I anchor what feels unstable.”", dept: "Host Team" },
        { text: "“I support without needing recognition.”", dept: "Welfare" },
        { text: "“I lift the room without saying much.”", dept: "Music" },
        { text: "“I carry weight others don’t always notice.”", dept: "Sanctuary Keepers" },
      ],
    },
    {
      question: "You're part of something bigger. What role naturally draws you in?",
      answers: [
        { text: "The watchful eye", dept: "Security" },
        { text: "The peacekeeper", dept: "Host Team" },
        { text: "The organiser", dept: "Administration" },
        { text: "The unseen protector", dept: "Sanctuary Keepers" },
        { text: "The one who holds the room together", dept: "Welfare" },
      ],
    },
    {
      question: "What do you believe brings real impact?",
      answers: [
        { text: "Order", dept: "Administration" },
        { text: "Encouragement", dept: "New Believers" },
        { text: "Truth", dept: "Evangelism" },
        { text: "Warmth", dept: "Hospitality" },
        { text: "Consistency", dept: "Welfare" },
      ],
    },
    {
      question: "You're attending a leadership retreat. What would be your takeaway?",
      answers: [
        { text: "“Structure births freedom.”", dept: "Administration" },
        { text: "“Presence changes everything.”", dept: "Host Team" },
        { text: "“Details are sacred.”", dept: "Production" },
        { text: "“Service isn’t always seen.”", dept: "Welfare" },
        { text: "“Culture is built on what’s unspoken.”", dept: "Sanctuary Keepers" },
      ],
    },
    {
      question: "You walk into an empty sanctuary before a service. What do you notice first?",
      answers: [
        { text: "Lighting and layout", dept: "Production" },
        { text: "Atmosphere and stillness", dept: "Host Team" },
        { text: "Whether everything’s in place", dept: "Sanctuary Keepers" },
        { text: "Who’s arrived early", dept: "Ushers" },
        { text: "What needs to be done quietly", dept: "Welfare" },
      ],
    },
    {
      question: "When someone is hurting, how do you usually respond inwardly?",
      answers: [
        { text: "Stay present with them", dept: "Welfare" },
        { text: "Think about how to support practically", dept: "Follow Up" },
        { text: "Begin praying immediately", dept: "New Believers" },
        { text: "Try to redirect their focus gently", dept: "Evangelism" },
        { text: "Observe to discern the real need", dept: "Host Team" },
      ],
    },
  ],

  kp2: [
    {
      question: "What’s your energy when no one’s watching?",
      answers: [
        { text: "Lofi chill", dept: "K-Music" },
        { text: "Silent but overthinking", dept: "Design" },
        { text: "Planning next move in your head", dept: "Administration" },
        { text: "Watching everything but saying nothing", dept: "Security" },
        { text: "Vibing then disappearing", dept: "Host Team" },
      ],
    },
    {
      question: "What’s your group chat role?",
      answers: [
        { text: "Drops memes out of nowhere", dept: "K-Drama" },
        { text: "Observes everything but replies late", dept: "Media" },
        { text: "Fixes beef with prayer hands", dept: "New Believers" },
        { text: "Sends reminders when people forget", dept: "Administration" },
        { text: "Disappears then comes back with full recap", dept: "Follow Up" },
      ],
    },
    {
      question: "Pick a random emoji that feels like “you.”",
      answers: [
        { text: "🔍", dept: "Security" },
        { text: "👀", dept: "Follow Up" },
        { text: "🙏", dept: "New Believers" },
        { text: "🧽", dept: "Hospitality" },
        { text: "🎚️", dept: "Production" },
      ],
    },
    {
      question: "Someone messes up the vibe mid-event. What’s your thought?",
      answers: [
        { text: "“That could’ve been smoother.”", dept: "Production" },
        { text: "“They’re probably nervous.”", dept: "Host Team" },
        { text: "“We move.”", dept: "Evangelism" },
        { text: "“Next time, I’d do it differently.”", dept: "Design" },
        { text: "“I clocked that before it happened.”", dept: "Security" },
      ],
    },
    {
      question: "You’re watching a movie. What kind of character do you always notice?",
      answers: [
        { text: "The quiet one who holds things together", dept: "Welfare" },
        { text: "The one who saves the day with one move", dept: "K-Drama" },
        { text: "The one who’s lowkey funny", dept: "K-Music" },
        { text: "The planner behind the scenes", dept: "Administration" },
        { text: "The one who never leaves the main character alone", dept: "Follow Up" },
      ],
    },
    {
      question: "What would be your role in a zombie apocalypse?",
      answers: [
        { text: "Person with the torch and map", dept: "Administration" },
        { text: "Scout who spots danger", dept: "Security" },
        { text: "Encourager keeping people sane", dept: "Welfare" },
        { text: "Fixer of everything broken", dept: "Production" },
        { text: "The one keeping the group alive emotionally", dept: "Host Team" },
      ],
    },
    {
      question: "How do you show love without saying it?",
      answers: [
        { text: "You think ahead for them", dept: "Administration" },
        { text: "You adjust things for their comfort", dept: "Hospitality" },
        { text: "You remember their stuff", dept: "Follow Up" },
        { text: "You let them take space", dept: "New Believers" },
        { text: "You notice their needs without asking", dept: "Welfare" },
      ],
    },
    {
      question: "Choose a random aesthetic for your life:",
      answers: [
        { text: "Static but powerful", dept: "Security" },
        { text: "Symmetry and soft lighting", dept: "Design" },
        { text: "Playlist with no skips", dept: "K-Music" },
        { text: "Organised chaos", dept: "Production" },
        { text: "Clean lines, quiet mood.", dept: "Host Team" },
      ],
    },
  ],
};

const departmentDescriptions = {
  "Administration": "Organize and manage church operations and events.",
  "Children's Department": "Teach and nurture children in their faith.",
  "Design": "Create visuals and designs for church materials and media.",
  "Drama": "Act and produce plays to share messages creatively.",
  "Hospitality": "Welcome and care for guests and congregation members.",
  "Host Team": "Facilitate a warm and welcoming church environment.",
  "Production/Media": "Manage sound, lighting, and technical equipment.",
  "Music": "Lead worship and play musical instruments during services.",
  "Follow Up": "Connect with newcomers and support spiritual growth.",
  "New Believers": "Help new Christians grow in their faith.",
  "Evangelism": "Share the Gospel and reach out to the community.",
  "Sanctuary Keepers": "Maintain and care for the worship spaces.",
  "Set-up": "Prepare rooms and equipment for events and services.",
  "Social Media": "Manage the church’s online presence and communications.",
  "Sound": "Ensure quality audio during church events.",
  "Uniform": "Manage and coordinate uniforms for teams.",
  "Ushers": "Assist in seating and helping attendees during services.",
  "Welfare": "Provide support and care to those in need.",
  "Security": "Maintain safety and security during events.",
  "K-Drama": "Perform and direct drama in KP2.",
  "Media": "Manage video and media production in KP2.",
  "K-Music": "Lead and perform music ministry in KP2."
};

let currentSet = null; // 'london' or 'kp2'
let currentQuestionIndex = 0;
let answers = [];
let scores = {};

const startLondonBtn = document.getElementById('start-london');
const startKP2Btn = document.getElementById('start-kp2');

startLondonBtn.addEventListener('click', () => startQuiz('london'));
startKP2Btn.addEventListener('click', () => startQuiz('kp2'));

backBtn.addEventListener('click', () => {
  if(currentQuestionIndex > 0){
    currentQuestionIndex--;
    answers.pop();
    recalculateScores();
    renderQuestion();
  }
  if(currentQuestionIndex === 0){
    backBtn.style.display = 'none';
  }
});

function startQuiz(set) {
  currentSet = set;
  currentQuestionIndex = 0;
  answers = [];
  scores = {};
  startScreenEl.style.display = 'none';
  resultEl.style.display = 'none';
  backBtn.style.display = 'none';
  quizEl.style.display = 'block';
  renderQuestion();
}

function renderQuestion() {
  backBtn.style.display = currentQuestionIndex > 0 ? 'inline-block' : 'none';
  const questionObj = questions[currentSet][currentQuestionIndex];
  if (!questionObj) {
    showResult();
    return;
  }

  quizEl.innerHTML = `
    <div class="question" id="question-text">${questionObj.question}</div>
    <div class="answers" role="list" aria-label="Possible answers">
      ${questionObj.answers.map((ans, i) => `
        <button class="btn answer-btn" data-index="${i}" role="listitem" aria-pressed="false">${ans.text}</button>
      `).join('')}
    </div>
  `;

  const answerButtons = quizEl.querySelectorAll('.answer-btn');
  answerButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      const index = parseInt(e.target.getAttribute('data-index'), 10);
      handleAnswer(index);
    });
  });

  // If user previously answered this question, highlight it
  if (answers[currentQuestionIndex] !== undefined) {
    const prevIndex = answers[currentQuestionIndex];
    if (answerButtons[prevIndex]) {
      answerButtons[prevIndex].setAttribute('aria-pressed', 'true');
    }
  }
}

function handleAnswer(answerIndex) {
  // Save answer for current question
  answers[currentQuestionIndex] = answerIndex;

  // Calculate scores
  recalculateScores();

  currentQuestionIndex++;

  if(currentQuestionIndex < questions[currentSet].length){
    renderQuestion();
  } else {
    showResult();
  }

  backBtn.style.display = 'inline-block';
}

function recalculateScores() {
  scores = {};
  for(let i = 0; i < answers.length; i++){
    const answerIdx = answers[i];
    if(answerIdx === undefined) continue;
    const dept = questions[currentSet][i].answers[answerIdx].dept;
    if(!scores[dept]) scores[dept] = 0;
    scores[dept]++;
  }
}

function showResult() {
  quizEl.style.display = 'none';
  backBtn.style.display = 'none';
  resultEl.style.display = 'block';

  // Find department with highest score
  let highestScore = 0;
  let winningDepartments = [];
  for(const dept in scores){
    if(scores[dept] > highestScore){
      highestScore = scores[dept];
      winningDepartments = [dept];
    } else if(scores[dept] === highestScore){
      winningDepartments.push(dept);
    }
  }

  // In case of tie, pick first alphabetically
  winningDepartments.sort();
  const topDept = winningDepartments[0] || "Administration";

  // Department description
  const description = departmentDescriptions[topDept] || "A valuable ministry in our church.";

  // Show result
  resultEl.innerHTML = `
    <h2>Your Recommended Department is:</h2>
    <div class="department">${topDept}</div>
    <div class="description">${description}</div>
    <button class="another-btn btn" id="restart-btn">Take the Quiz Again</button>
  `;

  document.getElementById('restart-btn').addEventListener('click', () => {
    resultEl.style.display = 'none';
    startScreenEl.style.display = 'block';
  });

  launchConfetti();
}

function launchConfetti() {
  // Use canvas-confetti library for confetti animation
  if (!window.confetti) return;

  const duration = 4 * 1000;
  const animationEnd = Date.now() + duration;
  const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 9999 };

  (function frame() {
    const timeLeft = animationEnd - Date.now();

    if (timeLeft <= 0) return;

    const particleCount = 50 * (timeLeft / duration);
    window.confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));

    requestAnimationFrame(frame);
  })();
}
</script>
</body>
</html>

